# EveryDiary 현재 이슈 분석 보고서

## 📅 **분석 일시**: 2024년 12월 19일

## 🔍 **발견된 주요 문제점**

### 1. **AI 이미지 생성 실패**

#### 문제 상황

- 터미널 로그: `❌ 이미지 생성 실패 (Gemini/Hugging Face 둘 다 실패)`
- API 키는 정상적으로 설정됨 (환경 변수로 확인)
- Hugging Face API 응답이 HTML 페이지로 반환됨

#### 로그 분석

```
I/flutter ( 4760): ❌ 이미지 생성 실패 (Gemini/Hugging Face 둘 다 실패)
I/flutter ( 4760): ❌ AI 생성 이미지 생성 실패
```

#### 추정 원인

1. **Hugging Face API 엔드포인트 문제**

   - 현재 사용 중: `https://api-inference.huggingface.co/models/runwayml/stable-diffusion-v1-5`
   - 응답이 HTML 페이지로 반환되는 것으로 보아 잘못된 엔드포인트일 가능성

2. **API 요청 형식 문제**

   - Hugging Face API의 올바른 요청 형식과 헤더 설정 필요
   - 모델별로 다른 요청 형식이 있을 수 있음

3. **Gemini API 문제**
   - Gemini는 이미지 생성이 아닌 텍스트 생성 API
   - 이미지 생성용 API로 변경 필요

### 2. **로그인 UI 누락**

#### 문제 상황

- 첨부 이미지에서 로그인 관련 UI가 전혀 보이지 않음
- Google 인증 시스템은 구현되었지만 실제 화면에 표시되지 않음
- 홈 화면에 로그인 버튼이나 사용자 정보가 없음

#### 구현된 파일들

- `lib/features/auth/screens/login_screen.dart` - 로그인 화면 구현됨
- `lib/core/services/google_auth_service.dart` - Google 인증 서비스 구현됨
- `lib/core/providers/google_auth_provider.dart` - 인증 상태 관리 구현됨

#### 추정 원인

1. **라우팅 설정 문제**

   - `app_router.dart`에서 로그인 화면 라우팅이 제대로 설정되지 않음
   - 초기 화면이 로그인 화면이 아닌 홈 화면으로 설정됨

2. **인증 상태 확인 로직 누락**

   - 홈 화면에서 사용자 인증 상태를 확인하는 로직이 없음
   - 인증되지 않은 사용자를 로그인 화면으로 리다이렉트하는 로직 누락

3. **UI 통합 문제**
   - 로그인 화면이 구현되었지만 실제 앱 플로우에 통합되지 않음

## 🛠️ **구현된 기능들**

### ✅ **완료된 기능**

1. **PWA 제거**: Android 네이티브 앱으로 전환 완료
2. **Google 인증 시스템**: 서비스 및 프로바이더 구현 완료
3. **Firebase 통합**: 인증 및 데이터베이스 설정 완료
4. **캐시 관리**: Android 캐시 서비스 구현 완료
5. **디버그 로그**: 실시간 로그 모니터링 기능 구현 완료

### ❌ **미해결 이슈**

1. **AI 이미지 생성**: API 엔드포인트 및 요청 형식 수정 필요
2. **로그인 UI**: 라우팅 및 인증 상태 관리 로직 수정 필요
3. **사용자 플로우**: 로그인 → 홈 화면 전환 로직 구현 필요

## 🔧 **필요한 수정사항**

### 1. **AI 이미지 생성 수정**

- Hugging Face API 올바른 엔드포인트 확인 및 수정
- Gemini API를 이미지 생성용으로 변경 (DALL-E 등)
- API 요청 형식 및 헤더 설정 검토

### 2. **로그인 UI 통합**

- `app_router.dart`에서 초기 라우팅을 로그인 화면으로 설정
- 홈 화면에서 인증 상태 확인 로직 추가
- 인증되지 않은 사용자 자동 리다이렉트 구현

### 3. **사용자 플로우 개선**

- 로그인 성공 시 홈 화면으로 자동 이동
- 로그아웃 기능 구현
- 사용자 정보 표시 UI 추가

## 📊 **현재 상태 요약**

| 기능           | 상태         | 비고                        |
| -------------- | ------------ | --------------------------- |
| PWA 제거       | ✅ 완료      | Android 네이티브로 전환     |
| Google 인증    | ⚠️ 부분 완료 | 서비스 구현됨, UI 통합 필요 |
| Firebase 통합  | ✅ 완료      | 설정 완료                   |
| AI 이미지 생성 | ❌ 실패      | API 엔드포인트 수정 필요    |
| 캐시 관리      | ✅ 완료      | Android 캐시 서비스 구현    |
| 디버그 로그    | ✅ 완료      | 실시간 모니터링 가능        |

## 🎯 **다음 단계**

1. **Perplexity를 통한 AI 이미지 생성 API 개선 방안 조사**
2. **로그인 UI 통합 및 사용자 플로우 구현**
3. **전체 앱 플로우 테스트 및 검증**

## 📝 **참고사항**

- API 키는 정상적으로 설정되어 있음
- 기본 인프라는 모두 구현되어 있음
- UI 통합 및 API 엔드포인트 수정이 주요 과제
- 사용자 경험 개선을 위한 플로우 최적화 필요
