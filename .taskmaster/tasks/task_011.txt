# Task ID: 11
# Title: 썸네일 시스템 구현
# Status: pending
# Dependencies: 5, 10
# Priority: medium
# Description: 일기 내용을 한 단어로 요약하고 연관된 이미지 썸네일을 생성하는 기능을 구현합니다.
# Details:
1. 썸네일 이미지 생성 품질 검증:
   - Gemini → Hugging Face 폴백 시스템 신뢰성 검증
   - 성공/실패율 로깅 및 모니터링
   - 회귀 테스트 추가
2. 오프라인 대응 썸네일 캐싱 시스템:
   - 썸네일 사전 생성 및 폴백 전략
   - 캐시 제거 정책 구현
   - 로컬 저장소 최적화
3. 사용자 썸네일 스타일 설정 UI:
   - 설정 > 사용자 커스터마이징 섹션 내 UI 구현
   - 썸네일 스타일 선택 옵션
   - 수동 키워드 설정 기능
4. 썸네일 생성 배치 처리 (성능 최적화)
5. 오프라인 모드 지원

참고: 텍스트 요약 및 키워드 추출 기능은 완료된 것으로 간주하며, 캘린더 통합은 기존 오렌지 점 표시 로직을 활용하여 이미 완료됨.

# Test Strategy:
1. Gemini → Hugging Face 폴백 시스템 신뢰성 테스트
2. 성공/실패율 로깅 및 모니터링 시스템 테스트
3. 오프라인 썸네일 캐싱 효율성 테스트
4. 캐시 제거 정책 동작 테스트
5. 사용자 설정 UI 사용성 테스트
6. 메모리 사용량 및 배터리 소모 테스트
7. 대용량 데이터 처리 성능 테스트
8. 회귀 테스트 (이미지 생성 품질 일관성)

# Subtasks:
## 1. Gemini → Hugging Face 폴백 시스템 품질 검증 [done]
### Dependencies: None
### Description: 현재 구현된 이미지 생성 폴백 시스템의 신뢰성을 검증하고 모니터링 체계를 구축합니다.
### Details:


## 2. 오프라인 대응 썸네일 캐싱 시스템 구현 [done]
### Dependencies: None
### Description: 오프라인 환경에서도 썸네일을 표시할 수 있도록 사전 생성 및 폴백 전략을 구현합니다.
### Details:


## 3. 썸네일 스타일 설정 UI 구현 [in-progress]
### Dependencies: None
### Description: 설정 > 사용자 커스터마이징 섹션에 썸네일 스타일 선택 및 수동 키워드 설정 UI를 추가합니다.
### Details:


## 4. 썸네일 생성 배치 처리 최적화 [pending]
### Dependencies: None
### Description: 성능 향상을 위한 썸네일 생성 배치 처리 시스템을 구현합니다.
### Details:


## 5. 회귀 테스트 및 품질 모니터링 시스템 구축 [pending]
### Dependencies: None
### Description: 이미지 생성 품질의 일관성을 보장하기 위한 회귀 테스트와 모니터링 시스템을 구축합니다.
### Details:


## 6. AI 이미지 프롬프트 통합 및 Gemini 출력 제어 [pending]
### Dependencies: 11.2
### Description: Gemini와 Hugging Face 모두 동일한 템플릿 기반 프롬프트를 사용하도록 통합하고, Gemini 생성 결과에서 텍스트 삽입을 방지하면서 일기 전체 맥락을 반영한 배경 묘사가 포함되도록 제약 조건을 강화합니다.
### Details:
- `lib/features/thumbnail` 및 `lib/features/ai_background` 계층에서 공통 프롬프트 빌더를 도입하여 Gemini/Hugging Face 호출이 동일한 값으로 구성되도록 합니다.
- Gemini 요청 시 negative prompt에 텍스트/워터마크 제거 규칙을 추가하고, 장면 배경 묘사를 일기 요약/감정값 기반으로 확장합니다.
- 기존 캐싱/폴백 로직이 새로운 프롬프트 구조에서도 정상 동작하는지 검증합니다.

## 7. 썸네일/배경 생성 차세대 설계 수립 [pending]
### Dependencies: 11.3, 11.4, 11.5
### Description: 향후 작업 계획을 위해 썸네일 캐싱, 프롬프트 파이프라인, 모니터링 체계를 포함한 차세대 설계를 수립하고 산출물을 정리합니다.
### Details:
- `docs/next-steps-2025-09-30.md` 기준 요구사항을 정리하고, UI/서비스/배치 구조를 포함하는 설계 문서를 작성합니다.
- 썸네일 스타일 설정 UI, 배치 처리, 회귀 테스트·모니터링을 포괄하는 아키텍처 다이어그램과 책임 분리를 정의합니다.
- 설계 검토 회의체(내부 리뷰 체크리스트)를 마련하고, 필요 시 PRD 업데이트 초안을 작성합니다.
